<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Subject</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script defer src="/js/scripts.js"></script> <!-- Include the JavaScript file -->
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center">Edit Subject</h1>

    <!-- Subject Edit Form -->
    <form id="subject-form">
        <input type="hidden" id="subjectId"> <!-- Hidden field for subject ID -->
        <div class="mb-3">
            <label for="code" class="form-label">Code</label>
            <input type="text" class="form-control" id="code" placeholder="Enter subject code" required>
        </div>
        <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input type="text" class="form-control" id="name" placeholder="Enter subject name" required>
        </div>
        <div class="mb-3">
            <label for="creditHours" class="form-label">Credit Hours</label>
            <input type="number" step="0.1" class="form-control" id="creditHours" placeholder="Enter credit hours" required>
        </div>
        <div class="text-end">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <a href="/Subject/Index.html" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
    // Get the subject ID from the URL query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const subjectId = urlParams.get('id');

    // Fetch subject data by ID and populate the form
    async function fetchSubjectById() {
        const response = await fetch(`/subjects/${subjectId}`);
        const subject = await response.json();

        // Populate form fields
        document.getElementById('subjectId').value = subject.subjectId;
        document.getElementById('code').value = subject.code;
        document.getElementById('name').value = subject.name;
        document.getElementById('creditHours').value = subject.creditHours;
    }

    // Handle form submission to update the subject
    const form = document.getElementById('subject-form');
    form.addEventListener('submit', async (event) => {
        event.preventDefault();

        // Collect updated data from the form
        const updatedSubject = {
            subjectId: document.getElementById('subjectId').value,
            code: document.getElementById('code').value,
            name: document.getElementById('name').value,
            creditHours: parseFloat(document.getElementById('creditHours').value),
        };

        // Send update request to the backend
        await fetch(`/subjects/${subjectId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updatedSubject),
        });

        // Redirect back to the Subject list
        window.location.href = '/Subject/Index.html';
    });

    // Initialize the form with existing data
    fetchSubjectById();
</script>
</body>
</html>
